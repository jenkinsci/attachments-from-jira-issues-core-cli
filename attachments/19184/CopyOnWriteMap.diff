Index: core/src/test/java/hudson/util/CopyOnWriteMapTest.java
===================================================================
--- core/src/test/java/hudson/util/CopyOnWriteMapTest.java	(revision 0)
+++ core/src/test/java/hudson/util/CopyOnWriteMapTest.java	(revision 0)
@@ -0,0 +1,42 @@
+/*
+ * The MIT License
+ * 
+ * Copyright (c) 2010, Yahoo!, Inc.
+ * 
+ * Permission is hereby granted, free of charge, to any person obtaining a copy
+ * of this software and associated documentation files (the "Software"), to deal
+ * in the Software without restriction, including without limitation the rights
+ * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
+ * copies of the Software, and to permit persons to whom the Software is
+ * furnished to do so, subject to the following conditions:
+ * 
+ * The above copyright notice and this permission notice shall be included in
+ * all copies or substantial portions of the Software.
+ * 
+ * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
+ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
+ * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
+ * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
+ * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
+ * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
+ * THE SOFTWARE.
+ */
+package hudson.util;
+
+import junit.framework.TestCase;
+
+/**
+ * @author Mike Dillon
+ */
+public class CopyOnWriteMapTest extends TestCase {
+    public static final class TestData {
+        CopyOnWriteMap.Tree<String,String> map1 = new CopyOnWriteMap.Tree<String,String>();
+    }
+
+    /**
+     * Verify that an empty CopyOnWriteMap.Tree can be serialized
+     */
+    public void testEmptyMapSerialization() throws Exception {
+        new XStream2().toXML(new TestData(),System.out);
+    }
+}
Index: core/src/main/java/hudson/util/CopyOnWriteMap.java
===================================================================
--- core/src/main/java/hudson/util/CopyOnWriteMap.java	(revision 27980)
+++ core/src/main/java/hudson/util/CopyOnWriteMap.java	(working copy)
@@ -61,7 +61,7 @@
     }
 
     protected CopyOnWriteMap() {
-        update(Collections.<K,V>emptyMap());
+        update(emptyMap());
     }
 
     private void update(Map<K, V> m) {
@@ -113,8 +113,10 @@
 
     protected abstract Map<K,V> copy();
 
+    protected abstract Map<K,V> emptyMap();
+
     public synchronized void clear() {
-        update(Collections.<K,V>emptyMap());
+        update(emptyMap());
     }
 
     /**
@@ -153,6 +155,10 @@
             return new LinkedHashMap<K,V>(core);
         }
 
+        protected Map<K,V> emptyMap() {
+            return Collections.<K,V>emptyMap();
+        }
+
         public static class ConverterImpl extends MapConverter {
             public ConverterImpl(Mapper mapper) {
                 super(mapper);
@@ -200,6 +206,10 @@
             return m;
         }
 
+        protected Map<K,V> emptyMap() {
+            return new TreeMap<K,V>(comparator);
+        }
+
         public static class ConverterImpl extends TreeMapConverter {
             public ConverterImpl(Mapper mapper) {
                 super(mapper);
